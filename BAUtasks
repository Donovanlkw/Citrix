####################################################################
### Get the enabled application in enabled DG ###

Get-BrokerDesktopGroup -filter {InMaintenanceMode -eq "False"}  | ForEach-Object {
Get-BrokerApplication -AllAssociatedDesktopGroupUUID $_.UUID.guid -filter {Enabled -eq "True"}  
     } |     Select-Object name, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}} |export-csv "$env:computername.csv"



$ComputerName="localhost"

#`r`

$computerName|out-file "serverlist.txt"
# -Encoding unicode

$parameters = @{
  ComputerName = Get-Content "serverlist.txt"
  ScriptBlock = {Get-BrokerDesktopGroup -filter {Enabled -eq "True"}  | ForEach-Object {
Get-BrokerApplication -AllAssociatedDesktopGroupUUID $_.UUID.guid -filter {Enabled -eq "True"}  
     } 
  }
}
Invoke-Command @parameters | Select-Object name, AllAssociatedDesktopGroupUUIDs, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}} |export-csv EnabledApplication.csv


####################################################################

#Get the ACL for Destkop
Get-BrokerAccessPolicyRule -MaxRecordCount 10000 |select-Object  DesktopGroupName, IncludedUserFilterEnabled  -ExpandProperty IncludedUsers | Format-table DesktopGroupName, IncludedUserFilterEnabled, FullName |out-file DG.csv

#Get the ACL for PusblishDesktop in XenApp
Get-BrokerEntitlementPolicyRule -MaxRecordCount 10000 |select-Object PublishedName, Enabled -ExpandProperty IncludedUsers | Format-table  PublishedName, Enabled, FullName |out-file Desktop.csv

#Get the ACL for ApplicationGroup access
Get-BrokerApplicationGroup -MaxRecordCount 10000 | Select-Object name, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}}  |export-csv AG.csv

#Get the ACL for Application access
Get-BrokerApplication -MaxRecordCount 10000 | Select-Object name, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}} |export-csv A.csv




####################################################################

#Get the SecureICA configuration 
