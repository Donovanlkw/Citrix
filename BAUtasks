#Get the SecureICA configuration 




####################################################################

#Get the ACL for Destkop
Get-BrokerAccessPolicyRule -MaxRecordCount 10000 |select-Object  DesktopGroupName, IncludedUserFilterEnabled  -ExpandProperty IncludedUsers | Format-table DesktopGroupName, IncludedUserFilterEnabled, FullName |out-file DG.csv

#Get the ACL for PusblishDesktop in XenApp
Get-BrokerEntitlementPolicyRule -MaxRecordCount 10000 |select-Object PublishedName, Enabled -ExpandProperty IncludedUsers | Format-table  PublishedName, Enabled, FullName |out-file Desktop.csv

#Get the ACL for ApplicationGroup access
Get-BrokerApplicationGroup -MaxRecordCount 10000 | Select-Object name, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}}  |export-csv AG.csv

#Get the ACL for Application access
Get-BrokerApplication -MaxRecordCount 10000 | Select-Object name, UserFilterEnabled, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}} |export-csv A.csv

####################################################################

#Get the VM Inventory from Citrix Studio
$computer = "DDC"
Invoke-Command -Computer $computer -ScriptBlock {
	Get-BrokerDesktop   -MaxRecordCount 10000 
 } |	Select-Object MachineName, @{l="AssociatedUserNames";e={$_.AssociatedUserNames -join ","}} |Export-Csv $computer
 
#Consolidate all the Inventory files.
Get-ChildItem -include azaw* -Recurse |get-content|Out-File StudioInventory -NoClobber
